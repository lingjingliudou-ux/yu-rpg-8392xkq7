<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚†ã†ã—ã‚ƒã®ç¥RPG</title>
<style>
body{
  background:black;
  color:white;
  font-family:monospace;
  text-align:center;
}

#game{
  max-width:520px;
  margin:auto;
  padding:20px;
  background:#111;
  border:4px solid white;
  position:relative;
}

button{
  margin:5px;
  padding:8px;
  background:black;
  color:white;
  border:2px solid white;
}

button:hover{
  background:white;
  color:black;
}

.bar{
  width:100%;
  background:#333;
  height:15px;
  margin:5px 0;
  border:1px solid white;
}

.fill{
  height:100%;
  background:lime;
}

.enemyFill{
  background:red;
}

#damage{
  position:absolute;
  font-size:22px;
  color:red;
  font-weight:bold;
  display:none;
}

@keyframes shake{
  0%{transform:translateX(0);}
  25%{transform:translateX(-5px);}
  50%{transform:translateX(5px);}
  75%{transform:translateX(-5px);}
  100%{transform:translateX(0);}
}

.shake{
  animation:shake 0.3s;
}

img{
  width:120px;
}
</style>
</head>
<body>

<div id="game">

<div id="title">
<h1>âš” ã‚†ã†ã—ã‚ƒã®ç¥ä¼èª¬</h1>
<button onclick="newGame()">ã¯ã˜ã‚ã‹ã‚‰</button>
<button onclick="continueGame()">ã¤ã¥ãã‹ã‚‰</button>
</div>

<div id="main" style="display:none;">

<p id="status"></p>

<div class="bar"><div id="hpBar" class="fill"></div></div>
<div class="bar"><div id="mpBar" class="fill" style="background:cyan;"></div></div>

<div id="map">
  <button onclick="forest()">ğŸŒ² æ£®</button>
  <button onclick="castle()">ğŸ° åŸ</button>
</div>

<div id="battle" style="display:none;">
  <h3 id="enemyName"></h3>

  <div class="bar">
    <div id="enemyBar" class="fill enemyFill"></div>
  </div>

  <img id="enemyImg">
  <br>

  <button onclick="attack()">âš” æ”»æ’ƒ</button>
  <button onclick="fire()">ğŸ”¥ ãƒ•ã‚¡ã‚¤ã‚¢</button>
</div>

<div id="damage"></div>
<div id="log"></div>

</div>
</div>

<script>
let hero;
let enemy;

function newGame(){
  localStorage.removeItem("ultimateSave");
  hero={
    hp:50,maxHp:50,
    mp:20,maxMp:20,
    level:1,gold:0
  };
  startGame();
}

function continueGame(){
  hero=JSON.parse(localStorage.getItem("ultimateSave"));
  if(!hero){ alert("ã‚»ãƒ¼ãƒ–ãŒãªã„ï¼"); return; }
  startGame();
}

function startGame(){
  document.getElementById("title").style.display="none";
  document.getElementById("main").style.display="block";
  update();
}

function save(){
  localStorage.setItem("ultimateSave",JSON.stringify(hero));
}

function update(){
  document.getElementById("status").innerText=
   "Lv:"+hero.level+" G:"+hero.gold;

  document.getElementById("hpBar").style.width=
    (hero.hp/hero.maxHp*100)+"%";

  document.getElementById("mpBar").style.width=
    (hero.mp/hero.maxMp*100)+"%";

  save();
}

function forest(){
  startBattle("ã‚¹ãƒ©ã‚¤ãƒ ",30,8,"https://i.imgur.com/4AiXzf8.png");
}

function castle(){
  startBattle("é­”ç‹",100,18,"https://i.imgur.com/7yUvePI.png");
}

function startBattle(name,hp,atk,img){
  enemy={name,hp,maxHp:hp,atk};
  document.getElementById("enemyName").innerText=name+" å‡ºç¾ï¼";
  document.getElementById("enemyImg").src=img;
  document.getElementById("enemyBar").style.width="100%";
  document.getElementById("battle").style.display="block";
  document.getElementById("map").style.display="none";
}

function showDamage(num){
  let d=document.getElementById("damage");
  d.innerText="-"+num;
  d.style.display="block";
  d.style.top="150px";
  d.style.left="220px";
  setTimeout(()=>{ d.style.display="none"; },500);
}

function attack(){
  let dmg=Math.floor(Math.random()*10)+5;
  enemy.hp-=dmg;
  showDamage(dmg);
  document.getElementById("enemyImg").classList.add("shake");
  setTimeout(()=>{
    document.getElementById("enemyImg").classList.remove("shake");
  },300);
  after();
}

function fire(){
  if(hero.mp<5) return;
  hero.mp-=5;
  let dmg=Math.floor(Math.random()*20)+10;
  enemy.hp-=dmg;
  showDamage(dmg);
  after();
}

function after(){
  if(enemy.hp<=0){
    hero.gold+=20;
    endBattle();
  }else{
    enemyTurn();
  }

  document.getElementById("enemyBar").style.width=
    (enemy.hp/enemy.maxHp*100)+"%";

  update();
}

function enemyTurn(){
  let dmg=Math.floor(Math.random()*enemy.atk)+5;
  hero.hp-=dmg;
  if(hero.hp<=0){
    alert("ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼");
    location.reload();
  }
}

function endBattle(){
  document.getElementById("battle").style.display="none";
  document.getElementById("map").style.display="block";
}
</script>

</body>
</html>
